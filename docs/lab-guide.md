# Process-Sample Cost Lab Guide

This guide provides detailed instructions for using the Process-Sample Cost Lab to optimize your New Relic ProcessSample event usage.

## Understanding ProcessSample Events

ProcessSample events are generated by the New Relic Infrastructure agent when process metrics collection is enabled. These events can contribute significantly to your data ingest costs if not properly optimized.

## Lab Components

1. **New Relic Infrastructure Agent**: Collects process metrics and sends them to your New Relic account.
2. **OpenTelemetry Collector**: Demonstrates alternative telemetry collection.
3. **Synthetic Load Generator**: Creates predictable CPU and memory usage for testing.

## Configuration Options

### Sample Rate

The sample rate is configured in `config/newrelic-infra.yml`:

```yaml
metrics_process_sample_rate: 60
```

This setting controls how frequently ProcessSample events are generated. The default is 60 seconds, but can be adjusted based on your monitoring needs.

### Process Command Line Collection

To reduce event size, process command line collection is disabled by default:

```yaml
collect_process_commandline: false
```

### Metric Filtering

Process metrics are excluded to avoid redundancy:

```yaml
exclude_matching_metrics:
  - process.*.*
```

## Security Best Practices

1. Use the minimal mounts configuration when possible.
2. Keep seccomp profiles enabled in production.
3. Avoid mounting the Docker socket unless container metrics are required.

## Validation and Analysis

Use the `validate_ingest.sh` script to check your ProcessSample ingest rates after making configuration changes.

## Common Issues

1. **High Ingest Volume**: If you see unexpectedly high ingest volumes, check the sample rate and consider filtering specific processes.

2. **Missing Data**: If process data is missing, verify that the process metrics are enabled and that seccomp is not blocking necessary syscalls.

3. **Performance Impact**: If the Infrastructure agent shows high CPU usage, consider increasing the sample rate interval.

## Advanced Usage

For advanced usage scenarios, consider the following:

1. Implement process-specific filtering based on names or resource usage.
2. Use infrastructure alerts to detect when process metrics deviate from expected patterns.
3. Create dashboards to visualize process resource usage over time.